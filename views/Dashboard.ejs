<!DOCTYPE html>
<html lang="en">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>

<%- include('./parts/head.ejs') -%>

  <body>
    <!--Navigation bar-->
    <%- include('./parts/nav.ejs') -%>
      <% if(message!=0) {%>
        <div class="alert alert-success" role="alert">
          <%=message %>
        </div>
        <% } %>

          <div class="container">
            <div class="d-flex flex-row">
              <div class="w-25 p-3 rounded bg-primary text-white" style="  margin: 5px; text-align: center">
                <%=json[0].no_users %> <small> Shoppers</small>
              </div>
              <div class="w-25 p-3 rounded  bg-warning text-dark" style=" margin: 5px; text-align: center">
                <%=json[0].total %> <small> Invoices</small>
              </div>
              <div class="w-25 p-3 rounded  bg-success text-white" style="  margin: 5px; text-align: center">
                <%=json[0].total_amount %> SAR <small> Total amount</small>
              </div>
              <div class="w-25 p-3 rounded bg-info text-white" style="  margin: 5px; text-align: center">
                <%=json3[0].total_product %> <small> Products</small>
              </div>
              <div class="w-25 p-3 rounded bg-danger text-white" style="  margin: 5px; text-align: center">
                <%=json2[0].product.name %> <small> is the Best product</small>
              </div>



            </div>
            <canvas id="myChart" style="width:100%;max-width:500px; margin: 50px;"></canvas>
          </div>

          <script>
            const s = parseInt("<%=storeId%>")
            var myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/json");

            var raw = JSON.stringify({
              "storeId": s
            });

            var requestOptions = {
              method: 'POST',
              headers: myHeaders,
              body: raw,
              redirect: 'follow'
            };

            fetch("http://localhost:3000/dashboard/dashboard4", requestOptions).then(res => res.json())
              .then(data => {
                var xyValues = []
                console.log(data.length)
                for (let index = 0; index < data.length; index++) {
                  xyValues.push({ x: data[index].Month, y: data[index].count})
                }
                new Chart("myChart", {
                  type: "scatter",
                  data: {
                    datasets: [{
                      pointRadius: 4,
                      pointBackgroundColor: "rgb(0,0,255)",
                      data: xyValues
                    }]
                  },
                  options: {
                    legend: { display: false },
                    scales: {
                      xAxes: [{ ticks: { min: 0, max: 12 } }],
                      yAxes: [{ ticks: { min: 0, max: 10 } }],
                    },
                    title: {
                      display: true,
                      text: "Best month",
                      fontSize: 16
                    }
                  }
                });

              }).catch(err => console.log(err))
          </script>
  </body>


</html>